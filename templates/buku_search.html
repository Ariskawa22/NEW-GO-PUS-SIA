{% extends 'base.html' %}
{% block title %}
    Daftar Buku
{% endblock %}
{% block body %}
    <style>
    .grid-container {
      --auto-grid-min-size: 16rem;

      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(var(--auto-grid-min-size), 1fr));
      grid-gap: 1rem;
    }
    </style>
    <script>
        const search = (e)=>{
            e.preventDefault()
            let name = document.getElementById("name").value
            fetch(`${window.location.origin}/buku/raw?query=${name}`).then((res)=>res.json().then((data)=>{
                let result = document.getElementById("result")
                result.innerHTML=""
                let resultarray = []
                data.forEach((apaaja)=>{
                    if(apaaja.fields.judul.toLowerCase().includes(name.toLowerCase())){
                        resultarray.push(apaaja)
                    }
                })
            resultarray.forEach((buku)=>{
                result.innerHTML+=`
                <a href="${window.location.origin}/buku/${buku.pk}">
			        <div style="text-align: center">
                        <img src="${ buku.fields.url_sampul }" style="max-width: 100%; max-height: 150px"><br>
                        <span style="font-weight: bold">${ buku.fields.judul }</span><br>
                        <span style="font-weight: bold">${ buku.fields.penulis }</span><br>
			        </div>
		        </a>`
            })
            }
            )
        )
        }
        const preload = (e) =>{
            console.log("yes")
            e.preventDefault()
            fetch(`${window.location.origin}/buku/raw`).then((res)=>res.json().then((data)=> {
                let result = document.getElementById("result")
                result.innerHTML=""
                let resultarray = []
                data.forEach((apaaja)=>{
                    resultarray.push(apaaja)
                }
            )
                resultarray.forEach((buku)=>{
                result.innerHTML+=`
                <a href="${window.location.origin}/buku/${buku.pk}">
			        <div style="text-align: center">
                        <img src="${ buku.fields.url_sampul }" style="max-width: 100%; max-height: 150px"><br>
                        <span style="font-weight: bold">${ buku.fields.judul }</span><br>
                        <span style="font-weight: bold">${ buku.fields.penulis }</span><br>
			        </div>
		        </a>`
            }
            )}))
        }
    </script>
    <h1>Daftar Buku</h1>
    <form onsubmit="search(event)">
        <label for="name">Nama Buku:</label><br>
        <input type="text" id="name" name="name"><br>
        <input type="submit" value="Cari">
    </form>
    <div class="grid-container" style="width: 100%" id="result" onload="preload">
        <div></div>
    </div>


{% endblock %}